$(document).ready(function(){function e(e){setTimeout(function(){A[e]=!0},1200)}function t(){for(var e=0;e<b.length;e++)if(b[e].data("line")==h){var t=f.offset().top;if(b[e].offset().top+parseInt(C)>=.97*parseInt(t)&&b[e].offset().top-parseInt(C)<=.92*t){var n=$(".crashSound")[0];x=0,n.volume=1,n.play(),$("#road").css("animation","none"),b=[],$("#gameBody").fadeOut("slow"),$("#scoreToAdd").html(10*w),$("#gameOverSection").css("display","flex"),$(".gameOver").fadeIn("slow"),setTimeout(function(){$(".gameOver").fadeOut("slow")},1600),setTimeout(function(){$(".yourScore").css("display","flex")},2200)}}}function n(){i()}function o(e){return $("<div class='generatedCar animateCar' data-line='"+e+"' ></div>")}function i(){if(g<v){var t=Math.floor(6*Math.random())+0;if(0==x)return!1;if(A[t]){var n=Math.floor(9*Math.random())+0,s=o(t);s.css("background-image","url(./img"+L[n]+")"),s.css("left",.067*$(window).width()+y*t),l.append(s),b.push(s),g++,A[t]=!1,e(t),setTimeout(function(){a(t,s)},6e3)}else i()}}function a(t,n){$("#road");var o=Math.floor(6*Math.random())+0,i=Math.floor(9*Math.random())+0;if(0==x)return!1;if(A[o]){Math.floor(6*Math.random());var s=n;s.css("animate",""),s.css("background-image","url(./img"+L[i]+")").css("left",.067*$(window).width()+y*o),s.data("line",o),w++,R(),$("#playerScore span").html(10*w),A[o]=!1,e(o),setTimeout(function(){a(o,s)},6e3)}else setTimeout(function(){a(t,n)},20)}function s(){T=!0}function r(){f.removeClass("turnRight"),f.addClass("turnLeft")}function c(){f.removeClass("turnLeft"),f.addClass("turnRight")}function u(){f.removeClass("turnLeft turnRight"),f.addClass("Forward")}var f=$("#playerCar"),l=$("#road"),d=$(window).height(),m=l.width(),p=m/7,h=3,v=5,g=0,w=0,T=!0,y=p,b=(f.position(),[]),C=f.css("height"),k=$("#turnLeft"),M=$("#turnRight"),O=$("#startBtn"),S=$("#menu"),I=$("#gameBody"),B=$("#addScoreBtn"),x=1,L=["/Ambulance.png","/Black_viper.png","/Mini_truck.png","/Mini_van.png","/Police.png","/truck.png","/Car.png","/taxi.png","/Ambulance.png"],A=[!0,!0,!0,!0,!0,!0];if(setInterval(t,100),$(".bcgMusic")[0].volume=.3,$(window).resize(function(){l=$("#road"),d=$(window).height(),m=l.width(),y=p=m/7}),k.on("touchstart",function(e){var t=p,n=f.position();!0===T&&(T=!1,0!=h?(setTimeout(s,400),r(),setTimeout(u,330),f.css("left",n.left-t),h--):0===h&&s())}),M.on("touchstart",function(e){var t=p,n=f.position();!0===T&&(T=!1,h<5?(setTimeout(s,400),f.css("left",n.left+t),c(),setTimeout(u,330),h++):5===h&&s())}),$(document).on("keydown",function(e){var t=p,n=f.position();!0===T&&"39"==e.keyCode?(T=!1,h<5?(setTimeout(s,400),f.css("left",n.left+t),c(),setTimeout(u,330),h++):5===h&&s()):!0===T&&"37"==e.keyCode&&(T=!1,0!=h?(setTimeout(s,400),r(),setTimeout(u,330),f.css("left",n.left-t),h--):0===h&&s())}),O.on("click",function(){S.css("display","none"),I.css("visibility","visible");setInterval(n,1100)}),B.on("click",function(e){e.preventDefault()}),B.one("click",function(e){e.preventDefault();var t=$("#nameInput").val();t.length>11?alert("Username too long!"):firebase.database().ref().push({userName:t,score:10*w},function(){firebase.database().ref().orderByChild("score").limitToLast(10).on("value",function(e){var t=e.exportVal(),n=[];Object.keys(t).forEach(function(e){var o=t[e];n.push(o)});var o=n.sort(function(e,t){return t.score-e.score});$("#gameOverSection").fadeOut("slow"),setTimeout(function(){$("#topTenSection").removeClass("hidden").fadeIn("slow").css("display","flex")},800),$("#gameOverSection").fadeOut("slow"),setTimeout(function(){$("#topTenSection").removeClass("hidden").fadeIn("slow").css("display","flex")},800);for(var i=0;i<o.length;i++)$("#topTenScores").append("<li><h3>"+(i+1)+".&nbsp;"+o[i].userName+"&nbsp;:&nbsp;"+o[i].score+"</h3></li>")})})}),$("#playAgainBtn").one("click",function(){location.reload()}),window.innerHeight>window.innerWidth)function R(){w<=30&&w%6==0?v++:w<=100&&w%30==0?v++:w<=300&&w%100==0?v++:w>300&&w%200==0&&v++}else{v=4;function R(){w<=30&&w%15==0?v++:w<=100&&w%35==0?v++:w<=300&&w%150==0?v++:w>300&&w%250==0&&v++}}});