$(document).ready(function(){function e(e){setTimeout(function(){A[e]=!0},1200)}function t(){for(var e=0;e<C.length;e++)if(C[e].data("line")==h){var t=l.offset().top;if(C[e].offset().top+parseInt(b)>=.97*parseInt(t)&&C[e].offset().top-parseInt(b)<=.92*t){var n=$(".crashSound")[0];x=0,n.volume=1,n.play(),$("#road").css("animation","none"),C=[],$("#gameBody").fadeOut("slow"),$("#scoreToAdd").html(10*w),$("#gameOverSection").css("display","flex"),$(".gameOver").fadeIn("slow"),setTimeout(function(){$(".gameOver").fadeOut("slow")},1600),setTimeout(function(){$(".yourScore").css("display","flex")},2200)}}}function n(){a()}function o(e){return $("<div class='generatedCar animateCar' data-line='"+e+"' ></div>")}function a(){if(g<v){var t=Math.floor(6*Math.random())+0;if(0==x)return!1;if(A[t]){var n=Math.floor(9*Math.random())+0,s=o(t);setTimeout(function(){i(t,s)},6e3),s.css("background-image","url(./img"+L[n]+")"),s.css("left",.067*$(window).width()+y*t),f.append(s),C.push(s),g++,A[t]=!1,e(t)}else a()}}function i(t,n){$("#road");var o=Math.floor(6*Math.random())+0,a=Math.floor(9*Math.random())+0;if(0==x)return!1;if(A[o]){Math.floor(6*Math.random());var s=n;s.removeClass("animateCar"),s.css("background-image","url(./img"+L[a]+")").css("left",.067*$(window).width()+y*o),s.addClass("animateCar").data("line",o),w++,R(),$("#playerScore span").html(10*w),A[o]=!1,e(o),setTimeout(function(){i(o,s)},6e3)}else i(t,n)}function s(){T=!0}function r(){l.removeClass("turnRight"),l.addClass("turnLeft")}function c(){l.removeClass("turnLeft"),l.addClass("turnRight")}function u(){l.removeClass("turnLeft turnRight"),l.addClass("Forward")}var l=$("#playerCar"),f=$("#road"),d=$(window).height(),m=f.width(),p=m/7,h=3,v=5,g=0,w=0,T=!0,y=p,C=(l.position(),[]),b=l.css("height"),k=$("#turnLeft"),M=$("#turnRight"),O=$("#startBtn"),S=$("#menu"),I=$("#gameBody"),B=$("#addScoreBtn"),x=1,L=["/Ambulance.png","/Black_viper.png","/Mini_truck.png","/Mini_van.png","/Police.png","/truck.png","/Car.png","/taxi.png","/Ambulance.png"],A=[!0,!0,!0,!0,!0,!0];if(setInterval(t,100),$(".bcgMusic")[0].volume=.3,$(window).resize(function(){f=$("#road"),d=$(window).height(),m=f.width(),y=p=m/7}),k.on("touchstart",function(e){var t=p,n=l.position();!0===T&&(T=!1,0!=h?(setTimeout(s,400),r(),setTimeout(u,330),l.css("left",n.left-t),h--):0===h&&s())}),M.on("touchstart",function(e){var t=p,n=l.position();!0===T&&(T=!1,h<5?(setTimeout(s,400),l.css("left",n.left+t),c(),setTimeout(u,330),h++):5===h&&s())}),$(document).on("keydown",function(e){var t=p,n=l.position();!0===T&&"39"==e.keyCode?(T=!1,h<5?(setTimeout(s,400),l.css("left",n.left+t),c(),setTimeout(u,330),h++):5===h&&s()):!0===T&&"37"==e.keyCode&&(T=!1,0!=h?(setTimeout(s,400),r(),setTimeout(u,330),l.css("left",n.left-t),h--):0===h&&s())}),O.on("click",function(){S.css("display","none"),I.css("visibility","visible");setInterval(n,1100)}),B.on("click",function(e){e.preventDefault()}),B.one("click",function(e){e.preventDefault();var t=$("#nameInput").val();t.length>11?alert("Username too long!"):firebase.database().ref().push({userName:t,score:10*w},function(){firebase.database().ref().orderByChild("score").limitToLast(10).on("value",function(e){var t=e.exportVal(),n=[];Object.keys(t).forEach(function(e){var o=t[e];n.push(o)});var o=n.sort(function(e,t){return t.score-e.score});$("#gameOverSection").fadeOut("slow"),setTimeout(function(){$("#topTenSection").removeClass("hidden").fadeIn("slow").css("display","flex")},800),$("#gameOverSection").fadeOut("slow"),setTimeout(function(){$("#topTenSection").removeClass("hidden").fadeIn("slow").css("display","flex")},800);for(var a=0;a<o.length;a++)$("#topTenScores").append("<li><h3>"+(a+1)+".&nbsp;"+o[a].userName+"&nbsp;:&nbsp;"+o[a].score+"</h3></li>")})})}),$("#playAgainBtn").one("click",function(){location.reload()}),window.innerHeight>window.innerWidth)function R(){w<=30&&w%6==0?v++:w<=100&&w%30==0?v++:w<=300&&w%100==0?v++:w>300&&w%200==0&&v++}else{v=4;function R(){w<=30&&w%15==0?v++:w<=100&&w%35==0?v++:w<=300&&w%150==0?v++:w>300&&w%250==0&&v++}}});